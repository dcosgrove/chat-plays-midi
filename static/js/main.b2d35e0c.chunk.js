(this["webpackJsonpchat-plays-midi"]=this["webpackJsonpchat-plays-midi"]||[]).push([[0],{132:function(e,t,n){},197:function(e,t,n){"use strict";n.r(t);var c=n(0),i=n.n(c),r=n(33),a=n.n(r),s=(n(132),n(50),n(51),n(6)),o=n(1),j="xsdpos4tnftz6tirr730o0c3u5lfsj",d=Object(c.createContext)({token:"",clientId:j,updateToken:function(){}}),l=function(e){var t=e.children,n=Object(c.useState)({token:"",expiresAt:""}),i=Object(s.a)(n,2),r=i[0],a=i[1];return Object(o.jsx)(d.Provider,{value:{token:r.token,clientId:j,updateToken:function(e,t){a({token:e,expiresAt:t})}},children:t})},u=n(8);var b=function(){var e=Object(c.useContext)(d).updateToken,t=document.location.hash.split("&")[0].replace("#access_token=","");return Object(c.useEffect)((function(){var n=Date.now();console.group("updating with",t,n),e(t,n)})),Object(o.jsx)("div",{children:""!==t?Object(o.jsx)(u.a,{replace:!0,to:"/"}):"Authorizing..."})},O=n(18),h=n(53),v=n(122);var f=function(e,t,n){var i=Object(c.useState)(null),r=Object(s.a)(i,2),a=r[0],o=r[1],j=Object(c.useState)("disconnected"),d=Object(s.a)(j,2),l=d[0],u=d[1];return Object(c.useEffect)((function(){if(!a&&""!==t){console.log("setting up Twitch pubsub client...");var c=new h.StaticAuthProvider(e,t),i=new v.SingleUserPubSubClient({authProvider:c});u("connecting"),i.onRedemption((function(e){var t=e.id,c=e.userDisplayName,i=e.rewardTitle,r=e.redemptionDate;n({id:t,userDisplayName:c,rewardTitle:i,redemptionDate:r})}),(function(e){throw e})),o(i),function(e,t){setInterval((function(){var n=e._pubSubClient,c=n.isConnected,i=n.isConnecting;t((function(){return c?"connected":i?"connecting":"disconnected"}))}),1e3)}(i,u)}}),[a,e,n,t]),l},x=Object(c.createContext)({events:[],registerEventListeners:function(e){},unregisterEventListener:function(e){},setEventListeners:function(){},eventListeners:[],connectionStatus:"disconnected"}),m=function(e){var t=e.children,n=Object(c.useState)([]),i=Object(s.a)(n,2),r=i[0],a=i[1],j=Object(c.useContext)(d),l=j.clientId,u=j.token,b=Object(c.useState)([]),h=Object(s.a)(b,2),v=h[0],m=h[1];Object(c.useEffect)((function(){if(r.length>0){var e=r[r.length-1].rewardTitle;v.forEach((function(t){var n=t.condition,c=t.effects;"channelPoint"===n.type&&n.name===e&&c.forEach((function(e){return(0,e.exec)()}))}))}}),[r]);var p=f(l,u,(function(e){var t=e.userDisplayName,n=e.rewardTitle,c=e.redemptionDate;a((function(e){return[].concat(Object(O.a)(e),[{userDisplayName:t,rewardTitle:n,redemptionDate:c}])}))}));return Object(o.jsx)(x.Provider,{value:{events:r,registerEventListeners:function(e){m((function(t){return[].concat(Object(O.a)(t),Object(O.a)(e))}))},unregisterEventListener:function(e){m((function(t){return t.filter((function(t){return t.id!==e}))}))},setEventListeners:m,eventListeners:v,connectionStatus:p},children:t})},p=n(205),g=n(214),y=n(201),C=n(202),D=n(123),I=n(203),w=n(204),T={kemper:"Kemper Profiler","neural-henson":"Neural DSP Archetype: Tim Henson","neural-gojira":"Neural DSP Archetype: Gojira"},S=n(91),k=n.n(S);var E=function(){var e=Object(c.useState)([]),t=Object(s.a)(e,2),n=t[0],i=t[1];return Object(c.useEffect)((function(){k.a.enable((function(e){e?(console.error("Unable to enable WebMIDI",e),i([])):i(k.a.outputs)}))}),[]),n},N=Object(c.createContext)({devices:[],setDevices:function(){},midiOutputs:[]}),A=function(e){var t=e.children,n=E(),i=Object(c.useState)([]),r=Object(s.a)(i,2),a=r[0],j=r[1];return Object(o.jsx)(N.Provider,{value:{devices:a,setDevices:j,midiOutputs:n},children:t})};var L=function(){var e=Object(c.useContext)(N),t=e.devices,n=e.setDevices;return Object(o.jsx)(y.a,{fluid:!0,children:Object(o.jsx)(C.a,{children:Object(o.jsxs)(D.a,{children:[Object(o.jsxs)(I.a,{striped:!0,bordered:!0,variant:"light",children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{children:"Alias"}),Object(o.jsx)("th",{children:"ID"}),Object(o.jsx)("th",{children:"Type"}),Object(o.jsx)("th",{})]})}),Object(o.jsx)("tbody",{children:t.map((function(e){return Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:e.alias}),Object(o.jsx)("td",{children:e.id}),Object(o.jsx)("td",{children:T[e.type]}),Object(o.jsx)("td",{children:Object(o.jsx)(w.a,{variant:"danger",onClick:function(){var c;c=e.id,n(t.filter((function(e){return e.id!==c})))},children:"Remove"})})]},e.key)}))})]}),0===t.length?Object(o.jsx)("h2",{children:"Add a new MIDI device to get started!"}):null]})})})},P=n(2),M=n(211),R=n(124),z=[["Toggle Overdrive",2],["Toggle Distortion",3],["Toggle Phaser",4],["Toggle Chorus",5],["Toggle Reverb",7],["Toggle Delay",8]],J=function(e,t){return z.reduce((function(n,c){var i=Object(s.a)(c,2),r=i[0],a=i[1];return n[r]=function(){e.sendControlChange(a,1,t)},n}),{})},K=function(e,t){return{"Delay On":function(){e.sendControlChange(27,1,t)},"Delay Off":function(){e.sendControlChange(27,0,t)}}},_=function(e){return Object(P.a)(Object(P.a)({},e),{},{effects:(t=e.output,n=e.midiChannel,c=e.type,"kemper"===c?K(t,n):"neural-henson"===c||"neural-gojira"===c?J(t,n):[])});var t,n,c};var B=function(){var e=Object(c.useState)({alias:"My Example Device",type:"",midiDevice:"",midiChannel:""}),t=Object(s.a)(e,2),n=t[0],i=t[1],r=Object(c.useContext)(N),a=r.devices,j=r.setDevices,d=r.midiOutputs;return Object(o.jsx)(y.a,{children:Object(o.jsx)(C.a,{children:Object(o.jsxs)(M.a,{children:[Object(o.jsx)(C.a,{children:Object(o.jsxs)(M.a.Group,{className:"mb-3",controlId:"formDeviceAlias",children:[Object(o.jsx)(M.a.Label,{children:"Device Name"}),Object(o.jsx)(M.a.Control,{value:n.alias,onChange:function(e){i(Object(P.a)(Object(P.a)({},n),{},{alias:e.target.value}))},type:"text"}),Object(o.jsx)(M.a.Text,{className:"text-muted",children:"Enter a name for the MIDI device you want to control"})]})}),Object(o.jsxs)(C.a,{className:"mb-3",children:[Object(o.jsx)(D.a,{md:!0,children:Object(o.jsx)(R.a,{controlId:"formDeviceType",label:"Device Type",children:Object(o.jsxs)(M.a.Select,{value:n.type,onChange:function(e){i(Object(P.a)(Object(P.a)({},n),{},{type:e.target.value}))},"aria-label":"Device Type",children:[Object(o.jsx)("option",{value:""}),Object.entries(T).map((function(e){var t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(o.jsx)("option",{value:n,children:c},n)}))]})})}),Object(o.jsx)(D.a,{md:!0,children:Object(o.jsx)(R.a,{controlId:"formMidiDevice",label:"MIDI Device",children:Object(o.jsxs)(M.a.Select,{value:n.midiDevice,onChange:function(e){i(Object(P.a)(Object(P.a)({},n),{},{midiDevice:e.target.value}))},"aria-label":"MIDI Device",children:[Object(o.jsx)("option",{value:""}),d.map((function(e){return Object(o.jsxs)("option",{value:e.id,children:[e.name," (",e.id,")"]},e.id)}))]})})}),Object(o.jsx)(D.a,{md:!0,children:Object(o.jsx)(R.a,{controlId:"formChannel",label:"MIDI Channel",children:Object(o.jsxs)(M.a.Select,{value:n.midiChannel,onChange:function(e){i(Object(P.a)(Object(P.a)({},n),{},{midiChannel:e.target.value}))},"aria-label":"MIDI Channel",children:[Object(o.jsx)("option",{value:""}),Object(O.a)(Array(16)).map((function(e,t){return Object(o.jsx)("option",{value:t+1,children:t+1},t)}))]})})})]}),Object(o.jsx)(C.a,{children:Object(o.jsx)(D.a,{children:Object(o.jsx)(w.a,{onClick:function(){var e;e={key:[n.midiDevice,"-",n.midiChannel].join(""),id:[n.midiDevice,"-",n.midiChannel].join(""),alias:n.alias,channel:n.midiChannel,type:n.type,output:d.find((function(e){return e.id===n.midiDevice}))},a.some((function(t){return t.key===e.key}))||j([].concat(Object(O.a)(a),[_(e)]))},variant:"primary",children:"Add Device"})})})]})})})};var U=function(){var e=Object(c.useContext)(N).devices.reduce((function(e,t){var n=Object.entries(t.effects).map((function(e){var n=Object(s.a)(e,2),c=n[0],i=n[1];return{key:"".concat(t.key,"-").concat(c),deviceAlias:t.alias,name:c,trigger:i}}));return[].concat(Object(O.a)(e),Object(O.a)(n))}),[]);return Object(o.jsx)(y.a,{fluid:!0,children:Object(o.jsx)(C.a,{children:Object(o.jsx)(D.a,{children:Object(o.jsxs)(I.a,{striped:!0,bordered:!0,variant:"light",children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{children:"Device"}),Object(o.jsx)("th",{children:"Effect"}),Object(o.jsx)("th",{children:"Test"})]})}),Object(o.jsx)("tbody",{children:e.map((function(e){return Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:e.deviceAlias}),Object(o.jsx)("td",{children:e.name}),Object(o.jsx)("td",{children:Object(o.jsx)(w.a,{onClick:function(){e.trigger()},children:"Trigger"})})]},e.key)}))})]})})})})},G=n(213);var V=function(){var e=Object(c.useContext)(x),t=e.events;return e.onNewEvent,Object(o.jsxs)(y.a,{children:[Object(o.jsx)("h2",{children:"Most Recent Events"}),Object(o.jsx)(G.a,{children:t.map((function(e){var t=e.userDisplayName,n=e.rewardTitle,c=e.redemptionDate;return Object(o.jsx)(G.a.Item,{children:"Username: ".concat(t," | Reward: ").concat(n," | Date: ").concat(c)},"".concat(t,"-").concat(c))}))})]})},H=function(e){var t=e.type,n=e.name;return"channelPoint"===t?"[Channel Points] ".concat(n):"Error"};var W=function(){var e=Object(c.useContext)(x),t=e.eventListeners,n=e.unregisterEventListener;return Object(o.jsx)(y.a,{fluid:!0,children:Object(o.jsx)(C.a,{children:Object(o.jsx)(D.a,{children:Object(o.jsxs)(I.a,{striped:!0,bordered:!0,variant:"light",children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{children:"Twitch Event"}),Object(o.jsx)("th",{children:"Device"}),Object(o.jsx)("th",{children:"Effects"}),Object(o.jsx)("th",{})]})}),Object(o.jsx)("tbody",{children:t.map((function(e){var t=e.id,c=e.condition,i=e.device,r=e.effects;return Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:H(c)}),Object(o.jsx)("td",{children:i.alias}),Object(o.jsx)("td",{children:r.reduce((function(e,t){return e+" "+t.name}),"")}),Object(o.jsx)("td",{children:Object(o.jsx)(w.a,{variant:"danger",onClick:function(){n(t)},children:"Remove"})})]},t)}))})]})})})})};var q=function(){var e=Object(c.useState)({device:{effects:[]},condition:{type:"",name:""},effects:[]}),t=Object(s.a)(e,2),n=t[0],i=n.device,r=n.condition,a=n.effects,j=t[1],d=Object(c.useContext)(N).devices,l=Object(c.useContext)(x).registerEventListeners;return Object(o.jsx)(y.a,{children:Object(o.jsx)(C.a,{children:Object(o.jsxs)(M.a,{children:[Object(o.jsxs)(C.a,{className:"mb-3",children:[Object(o.jsx)(D.a,{md:!0,children:Object(o.jsx)(R.a,{controlId:"formTwitchEvent",label:"Twitch Event Type",children:Object(o.jsxs)(M.a.Select,{value:r.type,onChange:function(e){j((function(t){return Object(P.a)(Object(P.a)({},t),{},{condition:{name:t.condition.name,type:e.target.value}})}))},"aria-label":"Device Type",children:[Object(o.jsx)("option",{value:""}),Object(o.jsx)("option",{value:"channelPoint",children:"Channel Points"}),Object(o.jsx)("option",{value:"bits",children:"Bits"}),Object(o.jsx)("option",{value:"subscriptions",children:"Subscriptions"})]})})}),Object(o.jsx)(D.a,{md:!0,children:Object(o.jsx)(R.a,{controlId:"floatingInputGrid",label:"Twitch Event: Value",children:Object(o.jsx)(M.a.Control,{type:"text",value:r.name,onChange:function(e){j((function(t){return Object(P.a)(Object(P.a)({},t),{},{condition:{type:t.condition.type,name:e.target.value}})}))},placeholder:"Tone: Toggle Reverb"})})}),Object(o.jsx)(D.a,{md:!0,children:Object(o.jsx)(R.a,{controlId:"formDevice",label:"Device",children:Object(o.jsxs)(M.a.Select,{value:i.id,onChange:function(e){j((function(t){return Object(P.a)(Object(P.a)({},t),{},{device:d.find((function(t){return t.id===e.target.value}))||{effects:[]}})}))},"aria-label":"Device",children:[Object(o.jsx)("option",{value:""}),d.map((function(e){var t=e.alias,n=e.key,c=e.id;return Object(o.jsx)("option",{value:c,children:t},n)}))]})})}),Object(o.jsx)(D.a,{md:!0,children:Object(o.jsx)(R.a,{controlId:"formEffects",label:"Effects",children:Object(o.jsxs)(M.a.Select,{value:a,onChange:function(e){j((function(t){return Object(P.a)(Object(P.a)({},t),{},{effects:e.target.value})}))},"aria-label":"MIDI Channel",children:[Object(o.jsx)("option",{value:""}),Object.keys(i.effects).map((function(e){return Object(o.jsx)("option",{value:e,children:e},e)}))]})})})]}),Object(o.jsx)(C.a,{children:Object(o.jsx)(D.a,{children:Object(o.jsx)(w.a,{onClick:function(){!function(e){var t={id:"".concat(e.device.alias,"-").concat(e.condition.type,"-").concat(e.condition.name),device:e.device,condition:e.condition,effects:[{name:e.effects,exec:e.device.effects[e.effects]}]};l([t])}({device:i,condition:r,effects:a})},variant:"primary",children:"Add Trigger"})})})]})})})},F=function(e){var t=JSON.parse(localStorage.getItem("".concat(e,"-triggers"))),n=JSON.parse(localStorage.getItem("".concat(e,"-devices")));return t&&n?{triggers:t,devices:n}:null};var Q=function(){var e=Object(c.useContext)(x),t=e.eventListeners,n=e.setEventListeners,i=Object(c.useContext)(N),r=i.devices,a=i.setDevices,j=i.midiOutputs,d=Object(c.useState)([]),l=Object(s.a)(d,2),u=(l[0],l[1]),b=function(e){var t=e.triggers,c=void 0===t?[]:t,i=e.devices,r=(void 0===i?[]:i).reduce((function(e,t){var n=e.devices,c=e.errors,i=j.find((function(e){return e.id===t.midiOutput}));if(i){var r=Object(P.a)(Object(P.a)({},t),{},{key:t.id,output:i});return{devices:[].concat(Object(O.a)(n),[_(r)]),errors:c}}return{devices:n,errors:[].concat(Object(O.a)(c),[new Error("Error loading configuration for device ".concat(t.alias," - ID ").concat(t.midiOutput," not found"))])}}),{devices:[],errors:[]});u(r.errors),a(r.devices);var s=c.reduce((function(e,t){var n=r.devices.find((function(e){return e.id===t.device}));if(n){var c=Object(P.a)(Object(P.a)({},t),{},{device:n,effects:t.effects.map((function(e){return{name:e,exec:n.effects[e]}}))});return[].concat(Object(O.a)(e),[c])}return e}),[]);return n(s),r.errors},h=Object(c.useState)(!0),v=Object(s.a)(h,2),f=v[0],m=v[1];return Object(c.useEffect)((function(){if(f){var e=F("current");if(e)0===b(e).length&&m(!1);else m(!1)}}),[j,f,m,b]),Object(o.jsxs)(y.a,{children:[Object(o.jsx)(C.a,{className:"mb-2",children:Object(o.jsx)(D.a,{children:Object(o.jsx)(w.a,{variant:"primary",onClick:function(){!function(e,t){var n=t.triggers,c=t.devices;localStorage.setItem("".concat(e,"-triggers"),JSON.stringify(n)),localStorage.setItem("".concat(e,"-devices"),JSON.stringify(c))}("current",{triggers:t.map((function(e){return{id:e.id,condition:e.condition,device:e.device.id,effects:e.effects.map((function(e){return e.name}))}})),devices:r.map((function(e){return{id:e.id,alias:e.alias,channel:e.channel,type:e.type,midiOutput:e.output.id}}))})},children:"Save Current Configuration"})})}),Object(o.jsx)(C.a,{children:Object(o.jsx)(D.a,{children:Object(o.jsx)(w.a,{variant:"primary",onClick:function(){var e=F("current");e&&b(e)},children:"Restore Last Saved Configuration"})})})]})};var X=function(){return Object(o.jsxs)(A,{children:[Object(o.jsxs)(p.a,{defaultActiveKey:"browser",id:"browser",className:"mb-3",children:[Object(o.jsxs)(g.a,{eventKey:"triggers",title:"Triggers",children:[Object(o.jsx)(W,{}),Object(o.jsx)(q,{})]}),Object(o.jsx)(g.a,{eventKey:"previewEffects",title:"Preview Effects",children:Object(o.jsx)(U,{})}),Object(o.jsxs)(g.a,{eventKey:"midiDevices",title:"Manage MIDI Devices",children:[Object(o.jsx)(L,{}),Object(o.jsx)(B,{})]}),Object(o.jsx)(g.a,{eventKey:"saveConfiguration",title:"Save/Load Configuration",children:Object(o.jsx)(Q,{})})]}),Object(o.jsx)("hr",{}),Object(o.jsx)(V,{})]})},Y=n(212),Z=n(215);var $=function(e){var t=Object(c.useContext)(d),n=t.clientId,i=""!==t.token,r="".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname,"authorize");return i?e.children:Object(o.jsx)(Y.a,{className:"mt-3",children:Object(o.jsx)(Y.a.Body,{children:Object(o.jsxs)(Z.a,{direction:"horizontal",gap:2,children:[Object(o.jsx)("div",{children:"Connect your Twitch.TV account in order to get started:"}),Object(o.jsx)(w.a,{onClick:function(){window.location.href="https://id.twitch.tv/oauth2/authorize?client_id=".concat(n,"&redirect_uri=").concat(r,"&response_type=token&scope=bits%3Aread%20channel%3Aread%3Aredemptions%20channel%3Aread%3Asubscriptions")},children:"Twitch.TV Login"})]})})})};var ee=function(){return Object(o.jsx)("h2",{children:"Invalid URL - page not found"})},te=n(210),ne=n(126),ce=n(90),ie=n(207),re=n(209),ae=n(206),se=n(208);var oe=function(){switch(Object(c.useContext)(x).connectionStatus){case"connected":return Object(o.jsxs)(ae.a,{variant:"success",className:"mb-0",children:[" ",Object(o.jsx)(ie.a,{color:"green"})," Connected to Twitch"]});case"connecting":return Object(o.jsxs)(ae.a,{variant:"primary",className:"mb-0",children:[" ",Object(o.jsx)(se.a,{size:"sm",animation:"border"})," Connecting..."]});case"disconnected":return Object(o.jsxs)(ae.a,{variant:"danger",className:"mb-0",children:[Object(o.jsx)(re.a,{color:"red"})," Disconnected from Twitch!"]});default:return Object(o.jsx)(ae.a,{variant:"warning",children:"Error checking connection status"})}};var je=function(){return Object(o.jsx)(l,{children:Object(o.jsx)(m,{children:Object(o.jsxs)("div",{className:"App",children:[Object(o.jsx)(te.a,{variant:"dark",bg:"dark",expand:"sm",className:"mb-3",children:Object(o.jsxs)(y.a,{children:[Object(o.jsx)(te.a.Brand,{children:"Chat Plays MIDI"}),Object(o.jsx)(ne.a,{className:"me-auto"}),Object(o.jsx)(ne.a.Item,{children:Object(o.jsx)(y.a,{children:Object(o.jsx)(oe,{})})})]})}),Object(o.jsx)(y.a,{children:Object(o.jsx)(ce.a,{basename:"/chat-plays-midi",children:Object(o.jsxs)(u.d,{children:[Object(o.jsx)(u.b,{path:"/",element:Object(o.jsx)(y.a,{children:Object(o.jsx)($,{children:Object(o.jsx)(X,{})})})}),Object(o.jsx)(u.b,{path:"/authorize",element:Object(o.jsx)(b,{})}),Object(o.jsx)(u.b,{path:"/*",element:Object(o.jsx)(ee,{})})]})})})]})})})};a.a.render(Object(o.jsx)(i.a.StrictMode,{children:Object(o.jsx)(je,{})}),document.getElementById("root"))},50:function(e,t,n){}},[[197,1,2]]]);
//# sourceMappingURL=main.b2d35e0c.chunk.js.map