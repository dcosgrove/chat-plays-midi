(this["webpackJsonpchat-plays-midi"]=this["webpackJsonpchat-plays-midi"]||[]).push([[0],{115:function(e,t,n){},180:function(e,t,n){"use strict";n.r(t);var c=n(0),i=n.n(c),r=n(28),a=n.n(r),o=(n(115),n(39),n(40),n(5)),s=n(1),l="xsdpos4tnftz6tirr730o0c3u5lfsj",j=Object(c.createContext)({token:"",clientId:l,updateToken:function(){}}),d=function(e){var t=e.children,n=Object(c.useState)({token:"",expiresAt:""}),i=Object(o.a)(n,2),r=i[0],a=i[1];return Object(s.jsx)(j.Provider,{value:{token:r.token,clientId:l,updateToken:function(e,t){a({token:e,expiresAt:t})}},children:t})},u=n(8);var b=function(){var e=Object(c.useContext)(j).updateToken,t=document.location.hash.split("&")[0].replace("#access_token=","");return Object(c.useEffect)((function(){var n=Date.now();console.group("updating with",t,n),e(t,n)})),Object(s.jsx)("div",{children:""!==t?Object(s.jsx)(u.a,{replace:!0,to:"/"}):"Authorizing..."})},h=n(22),O=n(41),v=n(104);var x=function(e,t,n){var i=Object(c.useState)(null),r=Object(o.a)(i,2),a=r[0],s=r[1];return Object(c.useEffect)((function(){if(console.log("running effect in TwitchPubSubClient"),!a&&""!==t){console.log("setting up pubsub client...");var c=new O.StaticAuthProvider(e,t);console.log("auth provider",c);var i=new v.SingleUserPubSubClient({authProvider:c});i.onRedemption((function(e){var t=e.id,c=e.userDisplayName,i=e.rewardTitle,r=e.redemptionDate;n({id:t,userDisplayName:c,rewardTitle:i,redemptionDate:r})}),(function(e){console.log("listening error",e)})),s(i)}return function(){console.log("pubsub effect teardown")}}),[a,e,n,t]),a},f=Object(c.createContext)({events:[],onNewEvent:function(e){e()},registerEventListeners:function(e){}}),p=function(e){var t=e.children,n=Object(c.useState)([]),i=Object(o.a)(n,2),r=i[0],a=i[1],l=Object(c.useContext)(j),d=l.clientId,u=l.token,b=Object(c.useState)([]),O=Object(o.a)(b,2),v=O[0],p=O[1];return Object(c.useEffect)((function(){if(r.length>0){var e=r[r.length-1].rewardTitle;v.forEach((function(t){var n=t.condition,c=t.action;"channelPoint"===n.type&&n.name===e&&(console.log("[Channel Point Redemption] Firing action for ".concat(e)),c())}))}}),[r]),x(d,u,(function(e){var t=e.userDisplayName,n=e.rewardTitle,c=e.redemptionDate;a((function(e){return[].concat(Object(h.a)(e),[{userDisplayName:t,rewardTitle:n,redemptionDate:c}])}))})),Object(s.jsx)(f.Provider,{value:{events:r,registerEventListeners:function(e){console.log("registering event listeners...",e),p((function(t){return console.log("setting event listener..."),[].concat(Object(h.a)(t),Object(h.a)(e))}))}},children:t})},m=n(187),g=n(191),D=n(183),y=n(184),C=n(105),T=n(185),w=n(186),I={kemper:"Kemper Profiler","neural-henson":"Neural DSP Archetype: Tim Henson","neural-gojira":"Neural DSP Archetype: Gojira"},k=n(72),A=n.n(k);var E=function(){var e=Object(c.useState)([]),t=Object(o.a)(e,2),n=t[0],i=t[1];return Object(c.useEffect)((function(){A.a.enable((function(e){e?(console.error("Unable to enable WebMIDI",e),i([])):i(A.a.outputs)}))}),[]),n},S=Object(c.createContext)({devices:[],setDevices:function(){},midiOutputs:[]}),P=function(e){var t=e.children,n=E(),i=Object(c.useState)([]),r=Object(o.a)(i,2),a=r[0],l=r[1];return Object(s.jsx)(S.Provider,{value:{devices:a,setDevices:l,midiOutputs:n},children:t})};var N=function(){var e=Object(c.useContext)(S),t=e.devices,n=e.setDevices;return Object(s.jsx)(D.a,{fluid:!0,children:Object(s.jsx)(y.a,{children:Object(s.jsxs)(C.a,{children:[Object(s.jsxs)(T.a,{striped:!0,bordered:!0,variant:"light",children:[Object(s.jsx)("thead",{children:Object(s.jsxs)("tr",{children:[Object(s.jsx)("th",{children:"Alias"}),Object(s.jsx)("th",{children:"ID"}),Object(s.jsx)("th",{children:"Type"}),Object(s.jsx)("th",{})]})}),Object(s.jsx)("tbody",{children:t.map((function(e){return Object(s.jsxs)("tr",{children:[Object(s.jsx)("td",{children:e.alias}),Object(s.jsx)("td",{children:e.id}),Object(s.jsx)("td",{children:I[e.type]}),Object(s.jsx)("td",{children:Object(s.jsx)(w.a,{variant:"danger",onClick:function(){var c;c=e.id,n(t.filter((function(e){return e.id!==c})))},children:"Remove"})})]},e.key)}))})]}),0===t.length?Object(s.jsx)("h2",{children:"Add a new MIDI device to get started!"}):null]})})})},M=n(2),R=n(188),L=n(106),z=function(e,t){return{"Delay On":function(){e.sendControlChange(27,1,t)},"Delay Off":function(){e.sendControlChange(27,0,t)}}},K=[["Toggle Overdrive",2],["Toggle Distortion",3],["Toggle Phaser",4],["Toggle Chorus",5],["Toggle Reverb",7],["Toggle Delay",8]],U=function(e,t){return K.reduce((function(n,c){var i=Object(o.a)(c,2),r=i[0],a=i[1];return n[r]=function(){console.log("sending cc",a),e.sendControlChange(a,1,t)},n}),{})};var _=function(){var e=Object(c.useState)({alias:"My Example Device",type:"",midiDevice:"",midiChannel:""}),t=Object(o.a)(e,2),n=t[0],i=t[1],r=Object(c.useContext)(S),a=r.devices,l=r.setDevices,j=r.midiOutputs;return Object(s.jsx)(D.a,{children:Object(s.jsx)(y.a,{children:Object(s.jsxs)(R.a,{children:[Object(s.jsx)(y.a,{children:Object(s.jsxs)(R.a.Group,{className:"mb-3",controlId:"formDeviceAlias",children:[Object(s.jsx)(R.a.Label,{children:"Device Name"}),Object(s.jsx)(R.a.Control,{value:n.alias,onChange:function(e){i(Object(M.a)(Object(M.a)({},n),{},{alias:e.target.value}))},type:"text"}),Object(s.jsx)(R.a.Text,{className:"text-muted",children:"Enter a name for the MIDI device you want to control"})]})}),Object(s.jsxs)(y.a,{className:"mb-3",children:[Object(s.jsx)(C.a,{md:!0,children:Object(s.jsx)(L.a,{controlId:"formDeviceType",label:"Device Type",children:Object(s.jsxs)(R.a.Select,{value:n.type,onChange:function(e){i(Object(M.a)(Object(M.a)({},n),{},{type:e.target.value}))},"aria-label":"Device Type",children:[Object(s.jsx)("option",{value:""}),Object.entries(I).map((function(e){var t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(s.jsx)("option",{value:n,children:c},n)}))]})})}),Object(s.jsx)(C.a,{md:!0,children:Object(s.jsx)(L.a,{controlId:"formMidiDevice",label:"MIDI Device",children:Object(s.jsxs)(R.a.Select,{value:n.midiDevice,onChange:function(e){i(Object(M.a)(Object(M.a)({},n),{},{midiDevice:e.target.value}))},"aria-label":"MIDI Device",children:[Object(s.jsx)("option",{value:""}),j.map((function(e){return Object(s.jsxs)("option",{value:e.id,children:[e.name," (",e.id,")"]},e.id)}))]})})}),Object(s.jsx)(C.a,{md:!0,children:Object(s.jsx)(L.a,{controlId:"formChannel",label:"MIDI Channel",children:Object(s.jsxs)(R.a.Select,{value:n.midiChannel,onChange:function(e){i(Object(M.a)(Object(M.a)({},n),{},{midiChannel:e.target.value}))},"aria-label":"MIDI Channel",children:[Object(s.jsx)("option",{value:""}),Object(h.a)(Array(16)).map((function(e,t){return Object(s.jsx)("option",{value:t+1,children:t+1},t)}))]})})})]}),Object(s.jsx)(y.a,{children:Object(s.jsx)(w.a,{onClick:function(){!function(e){var t,n,c;a.some((function(t){return t.key===e.key}))||l([].concat(Object(h.a)(a),[Object(M.a)(Object(M.a)({},e),{},{effects:(t=e.output,n=e.midiChannel,c=e.type,"kemper"===c?z(t,n):"neural-henson"===c||"neural-gojira"===c?U(t,n):[])})]))}({key:[n.midiDevice,"-",n.midiChannel].join(""),id:[n.midiDevice,"-",n.midiChannel].join(""),alias:n.alias,channel:n.midiChannel,type:n.type,output:j.find((function(e){return e.id===n.midiDevice}))})},variant:"primary",children:"Add Device"})})]})})})};var B=function(){var e=Object(c.useContext)(S).devices.reduce((function(e,t){var n=Object.entries(t.effects).map((function(e){var n=Object(o.a)(e,2),c=n[0],i=n[1];return{key:"".concat(t.key,"-").concat(c),deviceAlias:t.alias,name:c,trigger:i}}));return[].concat(Object(h.a)(e),Object(h.a)(n))}),[]);return Object(s.jsx)(D.a,{fluid:!0,children:Object(s.jsx)(y.a,{children:Object(s.jsx)(C.a,{children:Object(s.jsxs)(T.a,{striped:!0,bordered:!0,variant:"light",children:[Object(s.jsx)("thead",{children:Object(s.jsxs)("tr",{children:[Object(s.jsx)("th",{children:"Device"}),Object(s.jsx)("th",{children:"Effect"}),Object(s.jsx)("th",{children:"Test"})]})}),Object(s.jsx)("tbody",{children:e.map((function(e){return Object(s.jsxs)("tr",{children:[Object(s.jsx)("td",{children:e.deviceAlias}),Object(s.jsx)("td",{children:e.name}),Object(s.jsx)("td",{children:Object(s.jsx)(w.a,{onClick:function(){e.trigger()},children:"Trigger"})})]},e.key)}))})]})})})})},G=n(189);var J=function(){var e=Object(c.useContext)(f),t=e.events;return e.onNewEvent,Object(s.jsxs)(D.a,{children:[Object(s.jsx)("h2",{children:"Most Recent Events"}),Object(s.jsx)(G.a,{children:t.map((function(e){var t=e.userDisplayName,n=e.rewardTitle,c=e.redemptionDate;return Object(s.jsx)(G.a.Item,{children:"Username: ".concat(t," | Reward: ").concat(n," | Date: ").concat(c)},"".concat(t,"-").concat(c))}))})]})};var F=function(){var e=Object(c.useContext)(f).registerEventListeners,t=Object(c.useContext)(S).devices,n=Object(c.useState)([]),i=Object(o.a)(n,2),r=i[0],a=i[1];return Object(c.useEffect)((function(){if(t.length>0){var n=t[0],c={id:1,device:n.alias,condition:{type:"channelPoint",name:"Tone: Toggle Reverb"},action:n.effects["Toggle Reverb"]},i={id:2,device:n.alias,condition:{type:"channelPoint",name:"Tone: Toggle Delay"},action:n.effects["Toggle Delay"]},o={id:3,device:n.alias,condition:{type:"channelPoint",name:"Tone: Toggle OD"},action:n.effects["Toggle Overdrive"]};e([c,i,o]),a([].concat(Object(h.a)(r),[c,i,o]))}}),[t]),Object(s.jsx)(D.a,{children:Object(s.jsx)(G.a,{children:r.map((function(e){var t=e.id,n=e.condition,c=e.device;return Object(s.jsx)(G.a.Item,{children:"ID: ".concat(t," | Twitch Event: ").concat(n.name," | Device: ").concat(c," }")},t)}))})})};var H=function(){return Object(s.jsxs)(P,{children:[Object(s.jsxs)(m.a,{defaultActiveKey:"browser",id:"browser",className:"mb-3",children:[Object(s.jsx)(g.a,{eventKey:"triggers",title:"Triggers",children:Object(s.jsx)(F,{})}),Object(s.jsx)(g.a,{eventKey:"previewEffects",title:"Preview Effects",children:Object(s.jsx)(B,{})}),Object(s.jsxs)(g.a,{eventKey:"midiDevices",title:"Manage MIDI Devices",children:[Object(s.jsx)(N,{}),Object(s.jsx)(_,{})]})]}),Object(s.jsx)("hr",{}),Object(s.jsx)(J,{})]})},W=n(190);var q=function(e){var t=Object(c.useContext)(j),n=t.clientId,i=""!==t.token,r="".concat(window.location.protocol,"://").concat(window.location.host,"/authorize");return i?e.children:Object(s.jsx)(W.a,{children:Object(s.jsxs)(W.a.Body,{children:["Login to Twitch to get started!",Object(s.jsx)(w.a,{onClick:function(){window.location.href="https://id.twitch.tv/oauth2/authorize?client_id=".concat(n,"&redirect_uri=").concat(r,"&response_type=token&scope=bits%3Aread%20channel%3Aread%3Aredemptions%20channel%3Aread%3Asubscriptions")},children:"Login"})]})})};var Q=function(){return Object(s.jsx)("h2",{children:"Invalid URL - page not found"})},V=n(71);var X=function(){return Object(s.jsx)(d,{children:Object(s.jsx)(p,{children:Object(s.jsxs)("div",{className:"App",children:[Object(s.jsx)("header",{className:"App-header",children:Object(s.jsx)("p",{children:"Twitch - MIDI Adapter"})}),Object(s.jsx)(V.a,{basename:"/chat-plays-midi",children:Object(s.jsxs)(u.d,{children:[Object(s.jsx)(u.b,{path:"/",element:Object(s.jsx)(D.a,{children:Object(s.jsx)(q,{children:Object(s.jsx)(H,{})})})}),Object(s.jsx)(u.b,{path:"/authorize",element:Object(s.jsx)(b,{})}),Object(s.jsx)(u.b,{path:"/*",element:Object(s.jsx)(Q,{})})]})})]})})})};a.a.render(Object(s.jsx)(i.a.StrictMode,{children:Object(s.jsx)(X,{})}),document.getElementById("root"))},39:function(e,t,n){}},[[180,1,2]]]);
//# sourceMappingURL=main.0b5c803f.chunk.js.map